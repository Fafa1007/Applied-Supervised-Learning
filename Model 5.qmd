# Random Forest

## Modelling

Motivating clearly for our selected hyperparameters

```{r}
library(randomForest)

# Firstly, fit a basic Random Forest model with default hyperparameters
rf <- randomForest(Revenue ~ ., data = train,
                           ntree = 1000,
                           na.action = na.exclude)

# Secondly, calculating the missclassification error rate on the validation set
rf_pred   <- predict(rf, newdata = valid)
rf_mis   <- mean(as.numeric(unlist(y_valid)) != as.numeric(rf_pred))
```

Hyperparameter Tuned Random Forest

Hyper parameter tuning on the following: **mtry** Number of variables sampled at each split, **splitrule** Rule used to determine splits at each node, **min.node.size** Minimum number of observations required in a terminal node (leaf)

```{r}
library(randomForest)
library(caret)
library(ranger) # built in parallelisation 
library(dplyr)

# Firstly, define a grid of hyperparameters to search over
rf_grid <- expand.grid(mtry = 2:(ncol(train) - 1),
             splitrule = c('gini', 'hellinger'),
             min.node.size = c(1, 5, 10))

# Secondly, set up control parameters for the training process
ctrl <- trainControl(method = 'oob', verboseIter = F)

# Thirdly, perform a grid search to find the best hyperparameters using the ranger package
# This is also our Tuned Random Forest Model
rf_gridsearch <- train(Revenue ~ .,
                   data = train,
                   method = 'ranger',
                   num.trees = 1000,
                   trControl = ctrl,
                   tuneGrid = rf_grid,
                   importance = 'impurity')
plot(rf_gridsearch)

#Lastly, calculating the missclassification error rate on the validation set
rfgrid_pred <- predict(rf_gridsearch, newdata = valid)
rf_tuned_mis <- mean(as.numeric(unlist(y_valid)) != as.numeric(rfgrid_pred))

# Variance Importance Plot
plot(varImp(rf_gridsearch))
```

------------------------------------------------------------------------

\newpage

## Inference/Interpretation

------------------------------------------------------------------------

\newpage

## Model Evaluation

```{r}

```

------------------------------------------------------------------------

\newpage

## Optimizing F1 Score

------------------------------------------------------------------------

\newpage

## Prediction
