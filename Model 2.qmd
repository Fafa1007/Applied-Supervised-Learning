# Logistic Regression With A Non-Linear Decision Boundary

## Modelling

You may specify the model and regularize (or not) in any way you wish, just be sure to clearly state your final model.

Vanilla Model

```{r}
# Vanilla Logistic Regression Model
log_mod <- glm(Revenue ~ ., family = binomial,data = train)
log_mod %>% 
  tidy() %>%
  kable(digits = 2, caption = 'Vanilla Logistic Regression Model')
```

Polynomial Logistic Regression Models (choose the variables to make 5th degree polynomials by looking at the most significant numerical variables from the vanilla model)

1.  Polynomial Logistic Model with all variables

```{r}
poly_log1 <- glm(Revenue ~ 
            Informational + I(Informational^2) + I(Informational^3) +I(Informational^4) + 
            ProductRelated_Duration + I(ProductRelated_Duration^2) + I(ProductRelated_Duration^3) + I(ProductRelated_Duration^4) +
            ExitRates + I(ExitRates^2) + I(ExitRates^3) + I(ExitRates^4) + 
            PageValues + I(PageValues^2) + I(PageValues^3) + I(PageValues^4) + .
            ,data = train, family = 'binomial')
poly_log1 %>% 
  tidy() %>%
  kable(digits = 2, caption = 'Polynomial logistic regression model fitted to the online shopping dataset using all the varibles')
```

2.  Polynomial Logistic Model with only the polynomial variables

```{r}
poly_log2 <- glm(Revenue ~ 
            Informational + I(Informational^2) + I(Informational^3) +I(Informational^4) + 
            ProductRelated_Duration + I(ProductRelated_Duration^2) + I(ProductRelated_Duration^3) + I(ProductRelated_Duration^4) +
            ExitRates + I(ExitRates^2) + I(ExitRates^3) + I(ExitRates^4) + 
            PageValues + I(PageValues^2) + I(PageValues^3) + I(PageValues^4) 
            ,data = train, family = 'binomial')
poly_log2 %>% 
  tidy() %>%
  kable(digits = 2, caption = 'Polynomial logistic regression model fitted to the online shopping dataset using only the polynomial variables')

```

------------------------------------------------------------------------

\newpage

## Inference/Interpretation

------------------------------------------------------------------------

\newpage

## Model Evaluation

```{r}
library(MLmetrics)
library(caret)
library(knitr)
library(dplyr)
library(ROCR)

# Firstly, get predicted probabilities or predicted classe (gives the same conclusions) from the regularised logistic model
x_valid_dummies <- makeX(x_valid)
pred_probabilities <- predict(poly_log1, newx = as.matrix(x_valid_dummies), type = "response")

# Secondly, create a confusion matrix
yhat <- ifelse(pred_probabilities >= 0.5,'Revenue', "No Revenue")
y <- matrix(ifelse(as.numeric(unlist(y_valid))==2, 'Revenue', "No Revenue"))
cat("Confusion Matrix using Predicted Probabilities")
(confmat <- table(yhat, y, dnn = c('Predicted label', 'True label')))

# Thirdly, get the Accuracy, F1 Score, Precision, Recall, Specificity which we can calculate from the confusion matrix .... or us the caret package 
caretmat <- confusionMatrix(as.factor(yhat), as.factor(y), positive = 'Revenue')
caretmat 

Sensitivity <- caretmat$byClass["Sensitivity"]  # True Positive Rate (Recall)
Specificity <- caretmat$byClass["Specificity"]  # True Negative Rate
Precision <- caretmat$byClass["Precision"]      # Positive Predictive Value
F1_score <- caretmat$byClass["F1"]              # F1 Score
Accuracy <- caretmat$overall["Accuracy"]        # Accuracy
Missclassification_Rate <- mean(yhat != y)

# AUC (only works with binary data)
yhat <- ifelse(pred_probabilities >= 0.5, 1, 0)
y <- matrix(ifelse(as.numeric(unlist(y_valid))==2, 1, 0))
pred_obj <- prediction(y, yhat)
ROC_AUC <- performance(pred_obj, measure = "auc")@y.values[[1]]

# Lastly, put them all into a table
compar <- rbind(Sensitivity, Specificity, Precision, F1_score,Accuracy, Missclassification_Rate, ROC_AUC)
colnames(compar) <- c("Values")
compar %>% kable(caption = "Logistic Regression with Elastic Regularisation Evaluation Metric")
```

------------------------------------------------------------------------

\newpage

## Optimizing F1 Score

------------------------------------------------------------------------

\newpage

## Prediction
